{{ define "main" }}
<div class="notice-page">
  {{ if eq .Kind "list" }}
    <link rel="stylesheet" href="/css/notice.css">
  {{ else }}
    <link rel="stylesheet" href="/css/notice.css">
  {{ end }}

  <!-- Hero Section -->
  {{ if .Params.hero }}
  <section class="relative w-full" style="background-image: url('{{ .Params.hero.background.background_image }}'); background-position: top center; background-size: cover; height: 250px;">
    
    <!-- Gradient Overlay if enabled -->
    {{ if .Params.hero.background.background_gradient }}
      <div class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent opacity-50"></div>
    {{ end }}

    <div class="notice-hero container mx-auto px-4 py-8">
      <div class="flex flex-col justify-center items-center">
        <h1>{{ .Params.hero.headings.heading }}</h1>
        <p>{{ .Params.hero.headings.sub_heading }}</p>
      </div>
    </div>
    
    <!-- Blend Mode for Background Image if set -->
    {{ if eq .Params.hero.background.background_image_blend_mode "overlay" }}
      <div class="absolute inset-0 bg-black opacity-50"></div>
    {{ end }}
    </section>
  {{ end }}

  <!-- Filter Section -->
  <section class="notice-filter-section">
    <div class="notice-filter-container">
      <div class="notice-filter-wrapper">
        <!-- 카테고리 & 정렬 셀렉트 박스 -->
        <div class="notice-filter-selects">
          <select class="notice-select" id="category-select" onchange="filterNotices()">
            <option value="all">전체 카테고리</option>
            <option value="이벤트">이벤트</option>
            <option value="밋업">밋업</option>
            <option value="프로젝트">프로젝트</option>
            <option value="커뮤니티">커뮤니티</option>
            <option value="멤버십">멤버십</option>
            <option value="교육">교육</option>
          </select>
          <select class="notice-select" id="sort-select" onchange="sortNotices()">
            <option value="latest">최신순</option>
            <option value="oldest">오래된순</option>
            <option value="important">중요공지순</option>
          </select>
        </div>
        <!-- 검색 입력창 -->
        <div class="notice-search-wrapper">
          <!-- 돋보기 아이콘 -->
          <svg class="notice-search-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="18" height="18">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-4.35-4.35m0 0A7 7 0 1010.65 5.65a7 7 0 006 11.05z" />
          </svg>
          <!-- 검색 입력 필드 -->
          <input type="text" id="search-input" placeholder="공지사항 검색" class="notice-search-input" onkeyup="searchNotices()" />
        </div>
      </div>
    </div>
  </section>

<!--카테고리 & 정렬 박스 필터링 설정을 위한 JavaScript-->
<script>
  // 페이지네이션 관련 변수
  let currentPage = 1;
  const itemsPerPage = 10;
  let totalItems = 0;
  let totalPages = 0;

  // 페이지네이션 초기화
  function initializePagination() {
    const noticeItems = document.querySelectorAll('.notice-item');
    totalItems = noticeItems.length;
    totalPages = Math.ceil(totalItems / itemsPerPage);
    updatePagination();
    showPage(1);
  }

  // 페이지네이션 UI 업데이트
  function updatePagination() {
    const paginationNav = document.querySelector('.notice-pagination nav');
    paginationNav.innerHTML = '';

    // 이전 페이지 버튼
    const prevButton = document.createElement('button');
    prevButton.className = 'btn btn-icon' + (currentPage === 1 ? ' disabled' : '');
    prevButton.innerHTML = `
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path d="M15 18l-6-6 6-6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
      </svg>
    `;
    prevButton.onclick = () => {
      if (currentPage > 1) {
        showPage(currentPage - 1);
      }
    };
    paginationNav.appendChild(prevButton);

    // 페이지 번호 버튼
    for (let i = 1; i <= totalPages; i++) {
      const pageButton = document.createElement('button');
      pageButton.className = 'btn' + (i === currentPage ? ' btn-active' : '');
      pageButton.textContent = i;
      pageButton.onclick = () => showPage(i);
      paginationNav.appendChild(pageButton);
    }

    // 다음 페이지 버튼
    const nextButton = document.createElement('button');
    nextButton.className = 'btn btn-icon' + (currentPage === totalPages ? ' disabled' : '');
    nextButton.innerHTML = `
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path d="M9 18l6-6-6-6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
      </svg>
    `;
    nextButton.onclick = () => {
      if (currentPage < totalPages) {
        showPage(currentPage + 1);
      }
    };
    paginationNav.appendChild(nextButton);
  }

  // 특정 페이지 표시
  function showPage(page) {
    currentPage = page;
    const noticeItems = document.querySelectorAll('.notice-item');
    const startIndex = (page - 1) * itemsPerPage;
    const endIndex = Math.min(startIndex + itemsPerPage, totalItems);

    noticeItems.forEach((item, index) => {
      if (index >= startIndex && index < endIndex) {
        item.style.display = 'block';
      } else {
        item.style.display = 'none';
      }
    });

    updatePagination();
  }

  // 필터링 함수: 카테고리 필터와 검색 필터를 적용
  function filterNotices() {
    var categoryValue = document.getElementById('category-select').value;
    var searchValue = document.getElementById('search-input').value.toLowerCase();

    var noticeItems = document.querySelectorAll('.notice-item');
    var visibleItems = 0;

    noticeItems.forEach(function(item) {
      var category = item.getAttribute('data-category');
      var title = item.querySelector('h2').textContent.toLowerCase();

      var categoryMatch = categoryValue === 'all' || category === categoryValue;
      var searchMatch = title.includes(searchValue);

      if (categoryMatch && searchMatch) {
        item.style.display = 'block';
        visibleItems++;
      } else {
        item.style.display = 'none';
      }
    });

    // 필터링 후 페이지네이션 재설정
    totalItems = visibleItems;
    totalPages = Math.ceil(totalItems / itemsPerPage);
    currentPage = 1;
    updatePagination();
    showPage(1);
  }

  // 정렬 함수: 공지사항을 최신순, 오래된순, 중요공지순으로 정렬
  function sortNotices() {
    var sortValue = document.getElementById('sort-select').value;
    var noticeItems = Array.from(document.querySelectorAll('.notice-item'));
    var container = document.querySelector('.notice-list .space-y-4');

    // 현재 표시된 항목만 정렬
    noticeItems = noticeItems.filter(item => item.style.display !== 'none');

    if (sortValue === 'latest') {
      noticeItems.sort(function(a, b) {
        return new Date(b.getAttribute('data-date')) - new Date(a.getAttribute('data-date'));
      });
    } else if (sortValue === 'oldest') {
      noticeItems.sort(function(a, b) {
        return new Date(a.getAttribute('data-date')) - new Date(b.getAttribute('data-date'));
      });
    } else if (sortValue === 'important') {
      noticeItems.sort(function(a, b) {
        return (b.getAttribute('data-important') === 'true') - (a.getAttribute('data-important') === 'true');
      });
    }

    // 정렬된 순서대로 공지사항 항목을 재배치
    noticeItems.forEach(function(item) {
      container.appendChild(item);
    });

    // 정렬 후 현재 페이지 다시 표시
    showPage(currentPage);
  }

  // 검색 기능: 텍스트 검색 필터링
  function searchNotices() {
    filterNotices();
  }

  // 페이지 로드 시 페이지네이션 초기화
  document.addEventListener('DOMContentLoaded', initializePagination);
</script>

  <!-- Notices List Section -->
  <section class="notice-list py-4">
    <div class="container mx-auto">
      <div class="space-y-4" style="min-height: 200px;">
        {{ range .Data.Pages }}
          <a href="{{ .Permalink }}" class="block">
            <div class="notice-item relative"
              data-category="{{ if reflect.IsSlice .Params.category }}{{ index .Params.category 0 }}{{ else }}{{ .Params.category }}{{ end }}"
              data-date="{{ .Date.Format "2006-01-02" }}"
              data-important="{{ if eq .Params.important "true" }}true{{ else }}false{{ end }}">
              <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-2">
                <div class="flex items-center gap-2 mb-2 md:mb-0">
                  {{if .Params.category}}
                    {{ if reflect.IsSlice .Params.category }}  
                      {{ range .Params.category }}
                        <span class="notice-tag">{{ . }}</span>
                      {{ end }}
                    {{ else }}
                      <span class="notice-tag">{{ .Params.category }}</span>
                    {{end}}
                  {{else}}
                    <span class="notice-tag">카테고리 없음</span>
                  {{end}}

                  {{ if eq .Params.important "true" }}
                    <span class="notice-tag-important">중요</span>
                  {{ end }}
                </div>
                <div class="notice-date absolute top-2 right-2 flex items-center gap-1">
                  <svg class="notice-date-icon w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M8 7V3m8 4V3m-9 8h10m-11 4h12M4 5h16a2 2 0 012 2v14a2 2 0 01-2 2H4a2 2 0 01-2-2V7a2 2 0 012-2z" />
                  </svg>
                  <span>{{ .Date.Format "2006-01-02" }}</span>
                </div>
              </div>
              <h2 class="text-lg font-bold mb-1 text-black mb-1">{{ .Title }}</h2>
              <p class="text-sm text-black mb-2">{{ .Summary }}</p>
              <div class="flex justify-end">
                <span class="text-sm text-black flex items-center">자세히 보기</span>
              </div>
            </div>
          </a>
        {{ end }}
      </div>
      
      <!-- Pagination -->
      <div class="notice-pagination">
        <nav>
          <button class="btn btn-icon" >
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path d="M15 18l-6-6 6-6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
          </button>
          <button class="btn btn-active">1</button>
          <button class="btn">2</button>
          <button class="btn">3</button>
          <button class="btn btn-icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path d="M9 18l6-6-6-6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
          </button>
        </nav>
      </div>
    </div>
  </section>

  <!-- Subscribe Section -->
  <section class="py-12 bg-gray-50">
    <div class="container mx-auto px-4 text-center">
      <h2 class="text-2xl font-bold mb-6">중요 공지사항을 놓치지 마세요</h2>
      <p class="text-gray-600 max-w-2xl mx-auto mb-8">OpenInfra Korea의 뉴스레터를 구독하시면 중요 공지사항과 이벤트 정보를 이메일로 받아보실 수 있습니다.</p>
      <div class="flex flex-col sm:flex-row gap-2 justify-center max-w-md mx-auto">
        <input type="email" placeholder="이메일 주소" class="w-full sm:flex-1" />
        <button class="btn">구독하기</button>
      </div>
    </div>
  </section>
</div>
{{ end }}
